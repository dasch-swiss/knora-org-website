<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authentication in the Knora API Server &#8212; Knora 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Administration (Users, Projects, Groups, Institutions, Permissions)" href="administration.html" />
    <link rel="prev" title="Consistency Checking" href="consistency-checking.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../../index.html">Knora 0.1 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="consistency-checking.html" title="Consistency Checking"
             accesskey="P">previous</a> |
          <a href="administration.html" title="Administration (Users, Projects, Groups, Institutions, Permissions)"
             accesskey="N">next</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="authentication-in-the-knora-api-server">
<span id="authentication"></span><h1>Authentication in the Knora API Server<a class="headerlink" href="#authentication-in-the-knora-api-server" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#scope" id="id5">Scope</a></li>
<li><a class="reference internal" href="#implementation" id="id6">Implementation</a></li>
<li><a class="reference internal" href="#usage-v1" id="id7">Usage V1</a><ul>
<li><a class="reference internal" href="#login-and-logout" id="id8">Login and Logout</a></li>
<li><a class="reference internal" href="#submitting-credentials" id="id9">Submitting Credentials</a></li>
<li><a class="reference internal" href="#checking-credentials" id="id10">Checking Credentials</a></li>
<li><a class="reference internal" href="#usage-scenarios" id="id11">Usage Scenarios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-v2" id="id12">Usage V2</a><ul>
<li><a class="reference internal" href="#id1" id="id13">Login and Logout</a></li>
<li><a class="reference internal" href="#id2" id="id14">Submitting Credentials</a></li>
<li><a class="reference internal" href="#id3" id="id15">Checking Credentials</a></li>
<li><a class="reference internal" href="#id4" id="id16">Usage Scenarios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#skipping-authentication" id="id17">Skipping Authentication</a></li>
<li><a class="reference internal" href="#sipi-media-server" id="id18">Sipi (Media Server)</a></li>
<li><a class="reference internal" href="#improving-security" id="id19">Improving Security</a></li>
</ul>
</div>
<div class="section" id="scope">
<h2><a class="toc-backref" href="#id5">Scope</a><a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h2>
<p>Authentication is the process of making sure that if someone is accessing something then this someone is actually also
the someone he pretends to be. The process of making sure that someone is authorized, i.e. has the permission to access
something, is handled as described in the section on authorization (see: <a class="reference internal" href="administration.html#administration"><span class="std std-ref">Administration (Users, Projects, Groups, Institutions, Permissions)</span></a>) in the Knora base
ontology document.</p>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id6">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The authentication in Knora is based on Basic Auth <a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP basic authentication</a>, URL parameters, <a class="reference external" href="https://jwt.io">JSON Web Token</a> and
cookies. This means that on every request (to any of the routes), credentials need to be sent either via authorization
header, URL parameters or cookie header.</p>
<p>All routes are always accessible and if there are no credentials provided, a default user is assumed. If credentials
are sent and they are not correct (e.g., wrong username, password incorrect, token expired), then the request will end
in an error message.</p>
<p>There are some differences in <code class="docutils literal"><span class="pre">V1</span></code> and <code class="docutils literal"><span class="pre">V2</span></code> of the API regarding authentication. They differ mainly in the format
of the response and that creation of session cookies are only supported in <code class="docutils literal"><span class="pre">V1</span></code> and tokens in <code class="docutils literal"><span class="pre">V2</span></code>. After <cite>login</cite>
via either version, all routes (<code class="docutils literal"><span class="pre">V1</span></code> and <code class="docutils literal"><span class="pre">V2</span></code>) are accessible.</p>
</div>
<div class="section" id="usage-v1">
<h2><a class="toc-backref" href="#id7">Usage V1</a><a class="headerlink" href="#usage-v1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="login-and-logout">
<h3><a class="toc-backref" href="#id8">Login and Logout</a><a class="headerlink" href="#login-and-logout" title="Permalink to this headline">¶</a></h3>
<p>When a client accesses the <strong>/v1/session?login</strong> route successfully, it gets back headers requesting that a cookie
is created, which will store the session token. On all subsequent calls to any route, this session token needs to be
sent with each request. Normally, a web browser does this automatically, i.e. sends the cookie on every request. The
session token is used by the server to retrieve the user profile. If successful, the user is deemed authenticated.</p>
<p>To <strong>logout</strong> the client can call the same route and provide the logout parameter <strong>/v1/session?logout</strong>. This will
invalidate the session token and return headers for removing the cookie on the client.</p>
</div>
<div class="section" id="submitting-credentials">
<h3><a class="toc-backref" href="#id9">Submitting Credentials</a><a class="headerlink" href="#submitting-credentials" title="Permalink to this headline">¶</a></h3>
<p>For <strong>login</strong>, credentials in form of <em>email</em> and <em>password</em> need to be sent with the request.</p>
<dl class="docutils">
<dt>There are two possibilities to do so:</dt>
<dd><ul class="first last simple">
<li>in the URL submitting the parameters <code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">password</span></code> (e.g., <a class="reference external" href="http://knora-host/v1/resources/resIri?email=userUrlEncodedEmail&amp;password=pw">http://knora-host/v1/resources/resIri?email=userUrlEncodedEmail&amp;password=pw</a>)</li>
<li>in the HTTP authorization header (<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP basic authentication</a>) when doing a HTTP request to the API
When using Python&#8217;s module <code class="docutils literal"><span class="pre">requests</span></code>, the credentials can simply be submitted as a tuple with each request using
the param <code class="docutils literal"><span class="pre">auth</span></code> (<a class="reference external" href="http://docs.python-requests.org/en/master/user/authentication/#basic-authentication">python requests</a>).</li>
</ul>
</dd>
</dl>
<p>An alternative way for accessing all routes is to simply supply the <em>email</em> and <em>password</em> credentials on each request
either as URL parameters or in the HTTP authorization header.</p>
</div>
<div class="section" id="checking-credentials">
<h3><a class="toc-backref" href="#id10">Checking Credentials</a><a class="headerlink" href="#checking-credentials" title="Permalink to this headline">¶</a></h3>
<p>To check the credentials, there is a special route called <strong>/v1/authenticate</strong>, which can be used to check if the
credentials are valid.</p>
</div>
<div class="section" id="usage-scenarios">
<h3><a class="toc-backref" href="#id11">Usage Scenarios</a><a class="headerlink" href="#usage-scenarios" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create session by logging-in, send session token on each subsequent request, and logout when finished.</li>
<li>Send <em>email</em>/<em>password</em> credentials on every request.</li>
</ol>
</div>
</div>
<div class="section" id="usage-v2">
<h2><a class="toc-backref" href="#id12">Usage V2</a><a class="headerlink" href="#usage-v2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id13">Login and Logout</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A client sends a POST request (e.g., <code class="docutils literal"><span class="pre">{&quot;email&quot;:&quot;usersemail&quot;,</span> <span class="pre">&quot;password&quot;:&quot;userspassword&quot;}</span></code>) to the
<strong>/v2/authentication</strong> route with <em>email</em> and <em>password</em> in the body. If the credentials are valid,
a <a class="reference external" href="https://jwt.io">JSON WEB Token</a> (JWT) will be sent back in the response (e.g., <code class="docutils literal"><span class="pre">{&quot;token&quot;:</span> <span class="pre">&quot;eyJ0eXAiOiJ...&quot;}</span></code>). On all subsequent
calls to any route, this token can be sent with each request (instead of <em>email</em>/<em>password</em>). If the token is
successfully validated, then the user is deemed authenticated.</p>
<p>To <strong>logout</strong> the client sends a DELETE request to the same route <strong>/v2/authentication</strong> and the token (either as an
URL parameter or authorization header). This will invalidate the token.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id14">Submitting Credentials</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>When accessing any route and <em>email</em>/<em>password</em> credentials would need to be sent, we support two options to do so:</dt>
<dd><ul class="first last simple">
<li>in the URL submitting the parameters <code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">password</span></code> (e.g., <a class="reference external" href="http://knora-host/v1/resources/resIri?email=userUrlEncodedEmail&amp;password=pw">http://knora-host/v1/resources/resIri?email=userUrlEncodedEmail&amp;password=pw</a>)</li>
<li>in the HTTP header (<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP basic authentication</a>) when doing a HTTP request to the API
When using Python&#8217;s module <code class="docutils literal"><span class="pre">requests</span></code>, the credentials can simply be submitted as a tuple with each request using
the param <code class="docutils literal"><span class="pre">auth</span></code> (<a class="reference external" href="http://docs.python-requests.org/en/master/user/authentication/#basic-authentication">python requests</a>).</li>
</ul>
</dd>
<dt>When accessing any route and the <em>token</em> would need to be sent, we support two options to do so:</dt>
<dd><ul class="first last simple">
<li>in the URL submitting the parameter <code class="docutils literal"><span class="pre">token</span></code> (e.g., <a class="reference external" href="http://knora-host/v1/resources/resIri?token=1234567890">http://knora-host/v1/resources/resIri?token=1234567890</a>)</li>
<li>in the HTTP authorization header with the <code class="docutils literal"><span class="pre">`Bearer`</span></code> scheme (<a class="reference external" href="https://tools.ietf.org/html/rfc6750#section-2.1">HTTP bearer scheme</a>).</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id15">Checking Credentials</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>To check the credentials, there is a special route called <strong>/v1/authenticate</strong>, which can be used to check if the
credentials are valid.</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id16">Usage Scenarios</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create token by logging-in, send token on each subsequent request, and logout when finished.</li>
<li>Send <em>email</em>/<em>password</em> credentials on every request.</li>
</ol>
</div>
</div>
<div class="section" id="skipping-authentication">
<h2><a class="toc-backref" href="#id17">Skipping Authentication</a><a class="headerlink" href="#skipping-authentication" title="Permalink to this headline">¶</a></h2>
<p>There is the possibility to turn skipping authentication on and use a hardcoded
user (Test User). In <strong>application.conf</strong> set the <code class="docutils literal"><span class="pre">skip-authentication</span> <span class="pre">=</span> <span class="pre">true</span></code>
and Test User will be always assumed.</p>
</div>
<div class="section" id="sipi-media-server">
<h2><a class="toc-backref" href="#id18">Sipi (Media Server)</a><a class="headerlink" href="#sipi-media-server" title="Permalink to this headline">¶</a></h2>
<p>For authentication to work with the media server, we need to add support for cookies. At the moment the SALSAH-App
would set BasicAuth heathers, but this only works for AJAX requests using <code class="docutils literal"><span class="pre">SALSAH.ApiGet</span></code> (<code class="docutils literal"><span class="pre">Put</span></code>, etc.).
Since the medias are embedded as source tags, the browser would get them on his own, and doesn&#8217;t know anything about
the needed AuthHeathers. With cookies, the browser would send those automatically with every request. The media server
can use the credentials of the user requesting something for accessing the RepresentationsRouteV1, i.e. make this
request in the name of the user so to speak, then the RepresentationResponderV1 should have all the information it
needs to filter the result based on the users permissions.</p>
</div>
<div class="section" id="improving-security">
<h2><a class="toc-backref" href="#id19">Improving Security</a><a class="headerlink" href="#improving-security" title="Permalink to this headline">¶</a></h2>
<p>In the first iteration, the email/password would be sent in clear text. Since we will use HTTPS this shouldn&#8217;t be
a problem. The second iteration, could encrypt the email/password.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knora-ontologies/index.html">The Knora Ontologies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Knora API Server</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../deployment/index.html">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Knora API Server Design Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html">Developing the Knora API Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_v1/index.html">Using API V1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_v2/index.html">Using API V2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../salsah/index.html">SALSAH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sipi/index.html">Sipi</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="consistency-checking.html" title="Consistency Checking"
              >previous</a> |
            <a href="administration.html" title="Administration (Users, Projects, Groups, Institutions, Permissions)"
              >next</a> |
            <a href="../../../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../../../_sources/rst/knora-api-server/design-documentation/authentication.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Lukas Rosenthaler, Benjamin Geer, Ivan Subotic, Tobias Schweizer, André Kilchenmann, and Sepideh Alassi.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>