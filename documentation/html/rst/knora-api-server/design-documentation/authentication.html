<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authentication in the Knora API Server &mdash; Knora 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Knora 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Knora API Server Design Documentation" href="index.html" />
    <link rel="next" title="Plans for Knora API v2" href="plans-for-api-v2.html" />
    <link rel="prev" title="Consistency Checking" href="consistency-checking.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="../../../index.html">
          <span>Knora 0.1 documentation</span></a></h1>
        <h2 class="heading"><span>Authentication in the Knora API Server</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="consistency-checking.html">Consistency Checking</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="plans-for-api-v2.html">Plans for Knora API v2</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="authentication-in-the-knora-api-server">
<span id="authentication"></span><h1>Authentication in the Knora API Server<a class="headerlink" href="#authentication-in-the-knora-api-server" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scope">
<h2>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h2>
<p>Authentication is the process of making sure that if someone is
accessing something that then this someone is actually also the someone
he pretends to be. The process of making sure that someone is
authorized, i.e. has the permission to access something, is handled as
described in the section on authorization in the Knora base ontology
document. TODO: add a link to this.</p>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The authentication in Knora is based on Basic Auth
<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP basic authentication</a>, URL parameters, and cookies. This means that
on every request (to any of the routes), an authentication header, URL
parameters or cookie need to be sent.</p>
<p>All routes are always accessible and if there are no credentials
provided, a default user is assumed. If credentials are sent and they
are not correct (e.g., wrong username, password incorrect), then the
request will end in an error message. This is not true for a cookie
containing an expired session id. In this case, the default user is
assumed.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="checking-credentials">
<h3>Checking Credentials<a class="headerlink" href="#checking-credentials" title="Permalink to this headline">¶</a></h3>
<p>To check the credentials and create a &#8216;session&#8217;, e.g., by a login window
in the client, there is a special route called <strong>/v1/authentication</strong>,
which returns following for each case:</p>
<p><strong>Credentials correct:</strong></p>
<div class="highlight-python"><div class="highlight"><pre>{
  &quot;status&quot;: 0,
  &quot;message&quot;: &quot;credentials are OK&quot;.
  &quot;sid&quot;: &quot;1437643844783&quot;
}
</pre></div>
</div>
<p>In this case, the found user profile is written to a cache and stored
under the &#8216;&#8217;sid&#8217;&#8217; key. Also a header requesting to store the &#8216;&#8217;sid&#8217;&#8217; in
a cookie is sent. On subsequent access to all the other routes, the
&#8216;&#8217;sid&#8217;&#8217; is used to retrieve the cached user profile. If successful, the
user is deemed authenticated.</p>
<p><strong>Username wrong:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;bad credentials: user not found&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Password wrong:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;bad credentials: user found, but password did not match&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>No credentials:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span>
  <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;no credentials found&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="web-client-login-logout">
<h3>Web client (Login/Logout)<a class="headerlink" href="#web-client-login-logout" title="Permalink to this headline">¶</a></h3>
<p>When a web client accesses the <strong>/v1/authentication</strong> route
successfully, it gets back a cookie. To <strong>logout</strong> the client can call
the same route and provide the logout parameter
<strong>/v1/authenticate?logout</strong>. This will delete the cache entry and remove
the session id from the cookie on the client.</p>
</div>
<div class="section" id="submitting-credentials-in-the-url-or-in-the-http-authentication-header">
<h3>Submitting Credentials in the URL or in the HTTP Authentication Header<a class="headerlink" href="#submitting-credentials-in-the-url-or-in-the-http-authentication-header" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>As an alternative to creating a session, the client may also submit the credentials:</dt>
<dd><ul class="first last simple">
<li>in the URL (when doing a HTTP-GET request) submitting the parameters <code class="docutils literal"><span class="pre">username</span></code> and <code class="docutils literal"><span class="pre">password</span></code> (e.g. <a class="reference external" href="http://knora-host/resources/resIri?username=user&amp;password=pw">http://knora-host/resources/resIri?username=user&amp;password=pw</a>)</li>
<li>in the HTTP header (<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP basic authentication</a>) when doing a HTTP request to the API (all methods). When using Python&#8217;s module <code class="docutils literal"><span class="pre">requests</span></code>,
the credentials can simply be submitted as a tuple with each request using the param <code class="docutils literal"><span class="pre">auth</span></code> (<a class="reference external" href="http://docs.python-requests.org/en/master/user/authentication/#basic-authentication">python requests</a>).</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>The login form on the client can use <em>/v1/authentication</em> to check if
the username/password combination provided by the user is correct. The
username and password can be provided as URL parameters (see above).</li>
<li>on the server, this gets checked and a corresponding result as
described will be returned</li>
<li>all subsequent calls can then send these credentials as
authentication header or URL parameters (username / password), and in
the case of a web client just the cookie.</li>
</ol>
<p>Step 1 and 2 are optional, and can be skipped, if prior checking of the
credentials is not needed. Naturally, this won&#8217;t work for a web client
using cookies for authentication.</p>
</div>
<div class="section" id="skipping-authentication">
<h3>Skipping Authentication<a class="headerlink" href="#skipping-authentication" title="Permalink to this headline">¶</a></h3>
<p>There is the possibility to turn skipping authentication on and use a hardcoded
user (Test User). In <strong>application.conf</strong> set the
<code class="docutils literal"><span class="pre">skip-authentication</span> <span class="pre">=</span> <span class="pre">true</span></code> and Test User will be always
assumed.</p>
</div>
<div class="section" id="sipi-media-server">
<h3>Sipi (Media Server)<a class="headerlink" href="#sipi-media-server" title="Permalink to this headline">¶</a></h3>
<p>For authentication to work with the media server, we need to add support
for cookies. At the moment the SALSAH-App would set BasicAuth heathers,
but this only works for AJAX requests using <code class="docutils literal"><span class="pre">SALSAH.ApiGet</span></code> (<code class="docutils literal"><span class="pre">Put</span></code>, etc.).
Since the medias are embedded as source tags, the browser would get them
on his own, and doesn&#8217;t know anything about the needed AuthHeathers.
With cookies, the browser would send those automatically with every
request. The media server can the use the credentials of the user
requesting something for accessing the RepresentationsRouteV1, i.e. make
this request in the name of the user so to speak, then the
RepresentationResponderV1 should have all the information it needs to
filter the result based on the users permissions.</p>
</div>
<div class="section" id="improving-security">
<h3>Improving Security<a class="headerlink" href="#improving-security" title="Permalink to this headline">¶</a></h3>
<p>In the first iteration, the username/password would be sent in clear
text. Since we will use HTTPS this shouldn&#8217;t be a problem. The second
iteration, could encrypt the username/password.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="consistency-checking.html">Consistency Checking</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="plans-for-api-v2.html">Plans for Knora API v2</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Lukas Rosenthaler, Benjamin Geer, Ivan Subotic, Tobias Schweizer, André Kilchenmann, and André Fatton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>